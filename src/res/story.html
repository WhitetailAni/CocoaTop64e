<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2554.1">
  <style type="text/css">
    p.p2 {margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times; color: #0000e9; -webkit-text-stroke: #0000e9}
    span.s1 {font-kerning: none}
    span.s2 {font: 12.0px 'Songti SC'; font-kerning: none}
    span.s3 {font: 12.0px Times; text-decoration: underline ; font-kerning: none; color: #0000e9; -webkit-text-stroke: 0px #0000e9}
    span.s4 {text-decoration: underline ; font-kerning: none}
  </style>
</head>
<body>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Times; -webkit-text-stroke: #000000"><span class="s1"><b>Developers</b></span></h1>
<p class="p2"><span class="s2">★</span><span class="s1"> <a href="https://github.com/D0m0"><span class="s3">Domo</span></a> (the original author)</span></p>
<p class="p2"><span class="s2">★</span><span class="s1"> <a href="https://github.com/SongXiaoXi"><span class="s3">SongXiaoXi</span></a> aka SXX (iOS 13 support and lots of improvements)</span></p>
<p class="p2"><span class="s2">★</span><span class="s1"> <a href="https://github.com/Randomblock1"><span class="s3">Randomblock1</span></a> aka Benjamin G. (automatic .deb package assembly)</span></p>
<p class="p2"><span class="s2">★</span><span class="s1"> <a href="http://twitter.com/dylanduff3"><span class="s3">@DylanDuff3</span></a> (application icon)</span></p>
<p class="p2"><span class="s2">★</span><span class="s1"> <a href="http://twitter.com/whitetailani"><span class="s3">@DylanDuff3</span></a> (revised application icon, iOS 15+/rootless support)</span></p>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Times; -webkit-text-stroke: #000000"><span class="s1"><b>The Story</b></span></h1>
<p class="p2"><span class="s1">Hello, friends!</span></p>
<p class="p2"><span class="s1">This text should clarify some questionable concepts implemented in CocoaTop, the ideas behind those concepts, and the idea behind the application itself. Also, it should be a fun read, at least for some ;)</span></p>
<p class="p2"><span class="s1">Before we begin I would like to thank Luis Finke for making miniCode <a href="cydia://package/com.brokenphysics.miniCode"><span class="s3">(available in Cydia)</span></a> – a nice alternative to XCode that became an IDE for my first iOS app, which is also my first Objective C app. (Hey, if you think I typed the whole thing on the iPad, you're wrong. I even used <a href="cydia://package/net.howett.Theos"><span class="s3">Theos</span></a>, goddamit, okay! But that's not the point!</span></p>
<p class="p2"><span class="s1">Update: One of the most controversial topics concerning CocoaTop was the icon ;) . The original one, which I drew myself rather hastily, became the target of criticism on almost every forum or blog, not excluding Chinese, Korean, or some Hindu ones. That's when <a href="http://twitter.com/dylanduff3"><span class="s3">@DylanDuff3</span></a> kindly offered me his own version of the icon, which is used currently.</span></p>
<p class="p2"><span class="s1">Now, you could say that the purpose of CocoaTop is to replace the original terminal '<a href="cydia://package/top"><span class="s3">top</span></a>' – but it is not. First of all, the UNIX terminal is a thing in itself: every iPad user has to have a terminal installed, otherwise (s)he can be mistaken for a dork, or worse – a humanitarian. Also, 'top' executed on an iPad always attracts people's attention. So the idea behind CocoaTop is this: I wanted to create something nice, gaining knowledge in the process. If you find it useful, well, you're in luck!</span></p>
<p class="p2"><span class="s1">While working on CocoaTop I found <a href="http://newosxbook.com/index.php"><span class="s3">a book, a site, and a forum</span></a> by a man named Jonathan Levin. I don't know how I managed to overlook this hilarious stuff. It gave me a great inspiration boost, not to mention loads of bad-quality source code to ponder on. Thanks to Jonathan's in-depth coverage of hidden and undocumented APIs this version of CocoaTop features real-time per-process network statistics! Also, if you're into console utilities &amp; SSH, try his <a href="http://newosxbook.com/tools/procexp.html"><span class="s3">Process Explorer</span></a> for iOS and Mac OS X.</span></p>
<p class="p2"><span class="s1">Ok, on to the fun facts:</span></p>
<p class="p2"><span class="s2">★</span><span class="s1"> CPU usage sums up not to 100% but to cores×100%. Moreover, it can actually exceed this value, and it surely will when the cores are doing the real stuff: protein folding and shit like that. CPU exceeds 100% not for your amusement, but due to a scheduling policy of the Mach Kernel, which is called decay-usage scheduling. When a thread acquires CPU time, its priority is continually being depressed: this ensures short response times of interactive jobs, which do not always have a high initial priority, especially on weaker mobile platforms. The decayed CPU usage of a running thread increases in a linearly proportional fashion with CPU time obtained, and is periodically divided by the decay factor, which is a constant larger than one. Thus, the Mach CPU utilization of the process is a decaying average over up to a minute of previous (real) time. Since the time base over which this is computed varies (since processes may be very young) it is possible for the sum of all %CPU fields to exceed 100%. And this is why Android sucks. Also, because of Java, which isn't bad by itself, but... the mobile world?</span></p>
<p class="p2"><span class="s1">Update: You may have noticed that on older versions of CocoaTop the kernel task (pid 0) took up a lot of %CPU, in fact it took up all unused CPU power. This is because for every CPU core there's a kernel thread which halts the core when it's not used to save battery life, effectively eating up remaining CPU cycles. You can actually find these threads when you switch to process details, thread mode: they will have a small 'i' for 'idle' in the state column. Newer versions of CocoaTop no longer include there threads in kernel CPU usage. Unfortunately, on 64-bit devices information on kernel threads is substantially limited.</span></p>
<p class="p2"><span class="s2">★</span><span class="s1"> Everyone knows about processes, but what about Mach tasks? These are actually different things. In fact, it is technically possible to create a Mach task without a BSD process. A Mach task can actually be created without threads and memory (ah, the benefits of The Microkernel, my love). Mach tasks do not have parent-child relationships, those are implemented at the BSD level. This implies that BSD (or, generally, POSIX) has more morale, but not really. In UNIX, it is actually the norm for the parent to outlive its children. Furthermore, a parent actually expects their children to die, otherwise they rise as zombies. This is why I love pure microkernels.</span></p>
<p class="p2"><span class="s1">Update: A barebone task cannot be created in iOS usermode, because the corresponding API task_create() is removed. But the underlying kernel function task_create_internal() still exists and creates a task when a BSD process is launched.</span></p>
<p class="p2"><span class="s2">★</span><span class="s1"> You can kill processes by swiping to the left, but this seems cruel. One thing I would really prefer is killing zombies, but not sure if that fits with the iOS philosophy.</span></p>
<p class="p2"><span class="s1">Update: Actually, a zombie is not a process, but rather just a kernel entry for a process which no longer exists. So you can't kill it. The only reason for keeping it is to remind a parent process of a child's previous existence and save any bits of data left over by the child, i.e. an exit code. When the parent process finally collects these data (or dies), the zombie disappears.</span></p>
<p class="p2"><span class="s2">★</span><span class="s1"> There's no such thing as a running process, because it is the threads that run, not processes. So why is there a 'Process running' state? Well, this is done to simplify the output, and actually taken from the original 'top' source code. Most process states are calculated from thread states using a simple rule of precedence: i.e. if at least one thread is running, the process state is presumed 'R', and so on. The complete list is provided in the column info: just tap (i) at the 'Process state' item while managing columns.</span></p>
<p class="p2"><span class="s2">★</span><span class="s1"> There is also a column called 'Mach Actual Threads Priority'. What it actually contains is the highest priority of a thread within the process. This is also the way original 'top' works. Also, there are several scheduling schemes supported by Mach, but only one of them is actually used in iOS – 'Time Sharing'. The other two, 'Round-Robin' and 'FIFO', will be marked in this column using prefixes R: and F: respectively, but I've never seen them. I added those marks out of curiosity - write me a letter.</span></p>
<p class="p2"><span class="s1">Update: Round-robin scheduling is actually used for certain threads throughout the OS, especially kernel threads. In fact, all kernel threads default to the round-robin scheme: see for yourself! (If you're lucky to see kernel task details)</span></p>
<p class="p2"><span class="s2">★</span><span class="s1"> There's a 'Mach Task Role' column which actually shows the assigned role for GUI apps, like in macOS.</span></p>
<p class="p3"><span class="s4"><a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&amp;hosted_button_id=CSFS43BNNZYV6">Donate via PayPal, if you like this stuff</a></span></p>
<p class="p3"><span class="s4"><a href="mailto:joemama@thanos.lol?subject=CocoaTop%20feedback">Email for feedback and suggestions</a></span></p>
</body>
</html>
